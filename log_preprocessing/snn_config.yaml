# Configurazione per preparazione dati SNN
# Gestisce conversione log -> formato numerico per Spiking Neural Networks

# Configurazione finestre temporali
temporal_windows:
  # Lista di finestre temporali per raggruppamento eventi
  # Valori in millisecondi
  windows_ms: [1, 5, 10, 50, 100, 1000, 5000]
  
  # Finestre aggiuntive in secondi (convertite automaticamente)
  windows_seconds: [1, 5, 10, 30, 60]
  
  # Overlap tra finestre (percentuale 0.0-1.0)
  overlap: 0.1
  
  # Strategia per eventi multipli nella stessa finestra
  aggregation_strategy: "mean"  # "mean", "sum", "max", "min", "last"

# Configurazione normalizzazione
normalization:
  # Range di normalizzazione per features numeriche
  range: [0.0, 1.0]
  
  # Metodo di normalizzazione
  method: "min_max"  # "min_max", "z_score", "robust"
  
  # Clip outliers oltre questi percentili
  clip_percentiles: [0.01, 0.99]

# Configurazione encoding SNN
snn_encoding:
  # Tipo di encoding
  type: "rate_coding"  # "rate_coding", "temporal_coding", "population_coding"
  
  # Parametri rate coding
  rate_coding:
    max_frequency: 100.0  # Hz massima
    min_frequency: 0.1    # Hz minima
    
  # Parametri temporal coding
  temporal_coding:
    max_delay: 10.0      # ms massimo ritardo
    min_delay: 0.1       # ms minimo ritardo
    
  # Parametri population coding
  population_coding:
    neurons_per_feature: 8
    gaussian_centers: true

# Configurazione features per formato FortiGate - SOLO ESSENZIALI PER SNN
fortigate_features:
  # Campo timestamp obbligatorio
  timestamp_field: "eventtime"
  timestamp_fallback: ["date", "time"]  # Se eventtime non disponibile
  
  # Features numeriche continue - PORTE E PROTOCOLLO
  continuous_features:
    - field: "srcport"
      normalize: true
      encoding: "direct"
      description: "Porta sorgente"
    - field: "dstport" 
      normalize: true
      encoding: "direct"
      description: "Porta destinazione"
    - field: "proto"
      normalize: true
      encoding: "direct"
      description: "Protocollo (6=TCP, 17=UDP, etc)"
    - field: "sentbyte"
      normalize: true
      encoding: "log_scale"
      description: "Dimensione pacchetto - byte inviati"
    - field: "rcvdbyte"
      normalize: true
      encoding: "log_scale"
      description: "Dimensione pacchetto - byte ricevuti"
  
  # Features categoriali - TIPO EVENTO E ESITO
  categorical_features:
    - field: "action"
      encoding: "one_hot"
      max_categories: 5
      description: "Esito (accept, deny, etc)"
    - field: "type"
      encoding: "one_hot"
      max_categories: 3
      description: "Tipo evento (traffic, event, etc)"
  
  # Features IP - PATTERN DI TRAFFICO
  ip_features:
    - field: "srcip"
      encoding: "crypto_pan"
      preserve_subnet: true
      subnet_bits: 24
      description: "IP sorgente"
    - field: "dstip"
      encoding: "crypto_pan"
      preserve_subnet: true
      subnet_bits: 24
      description: "IP destinazione"
  
  # Features da escludere - TUTTO IL RESTO
  exclude_fields:
    - "logver"
    - "idseq" 
    - "itime"
    - "devid"
    - "devname"
    - "vd"
    - "date"
    - "time"
    - "tz"
    - "logid"
    - "subtype"
    - "level"
    - "srcintf"
    - "srcintfrole"
    - "dstintf"
    - "dstintfrole"
    - "srccountry"
    - "dstcountry"
    - "sessionid"
    - "policyid"
    - "policytype"
    - "service"
    - "trandisp"
    - "app"
    - "duration"
    - "sentpkt"
    - "rcvdpkt"
    - "appcat"
    - "crscore"
    - "craction"
    - "crlevel"

# Configurazione features per formato CSV (XDR/EDR) - SOLO ESSENZIALI PER SNN
csv_features:
  # Campo timestamp obbligatorio
  timestamp_field: "Event Time"
  
  # Features numeriche continue - PORTE E PROTOCOLLO
  continuous_features:
    - field: "Remote Port"
      normalize: true
      encoding: "direct"
      description: "Porta remota"
    - field: "Local Port"
      normalize: true
      encoding: "direct"
      description: "Porta locale"
    - field: "Process Id"
      normalize: true
      encoding: "hash_numeric"
      hash_size: 16
      description: "Process ID (come indicatore dimensione)"
  
  # Features categoriali - TIPO EVENTO E ESITO
  categorical_features:
    - field: "Action Type"
      encoding: "one_hot"
      max_categories: 10
      description: "Tipo evento (NamedPipeCreation, etc)"
    - field: "Protocol"
      encoding: "one_hot"
      max_categories: 5
      description: "Protocollo di rete"
  
  # Features IP - PATTERN DI TRAFFICO
  ip_features:
    - field: "Remote IP"
      encoding: "secure_hash"
      description: "IP remoto"
    - field: "Local IP"
      encoding: "secure_hash"
      description: "IP locale"
  
  # Features da escludere - TUTTO IL RESTO
  exclude_fields:
    - "Machine Id"
    - "Computer Name"
    - "File Name"
    - "Folder Path"
    - "Sha1"
    - "Sha256"
    - "MD5"
    - "Process Command Line"
    - "Account Domain"
    - "Account Name"
    - "Account Sid"
    - "Logon Id"
    - "Process Creation Time"
    - "Process Token Elevation"
    - "Registry Key"
    - "Registry Value Name"
    - "Registry Value Data"
    - "Remote Url"
    - "Remote Computer Name"
    - "File Origin Url"
    - "File Origin IP"
    - "Initiating Process SHA1"
    - "Initiating Process SHA256"
    - "Initiating Process File Name"
    - "Initiating Process Folder Path"
    - "Initiating Process Id"
    - "Initiating Process Command Line"
    - "Initiating Process Creation Time"
    - "Initiating Process Integrity Level"
    - "Initiating Process Token Elevation"
    - "Initiating Process Parent Id"
    - "Initiating Process Parent File Name"
    - "Initiating Process Parent Creation Time"
    - "Initiating Process MD5"
    - "Initiating Process Account Domain"
    - "Initiating Process Account Name"
    - "Initiating Process Account Sid"
    - "Initiating Process Logon Id"
    - "Report Id"
    - "Additional Fields"
    - "Typed Details"
    - "App Guard Container Id"
    - "Logon Type"
    - "Process Integrity Level"
    - "Registry Value Type"
    - "Previous Registry Value Name"
    - "Previous Registry Value Data"
    - "Previous Registry Key"
    - "File Origin Referrer Url"
    - "Sensitivity Label"
    - "Sensitivity Sub Label"
    - "Is Endpoint Dlp Applied"
    - "Is Azure Info Protection Applied"
    - "Alert Ids"
    - "Categories"
    - "Severities"
    - "Is Marked"
    - "Data Type"

# Configurazione features per formato NSL-KDD (CSV tabellare) - adattata a SNN
nsl_kdd_features:
  timestamp_field: "Timestamp"  # viene creato sinteticamente se assente
  continuous_features:
    - field: "duration"
      normalize: true
      encoding: "direct"
    - field: "src_bytes"
      normalize: true
      encoding: "log_scale"
    - field: "dst_bytes"
      normalize: true
      encoding: "log_scale"
    - field: "count"
      normalize: true
      encoding: "direct"
    - field: "srv_count"
      normalize: true
      encoding: "direct"
  categorical_features:
    - field: "protocol_type"
      encoding: "one_hot"
      max_categories: 5
    - field: "service"
      encoding: "one_hot"
      max_categories: 20
    - field: "flag"
      encoding: "one_hot"
      max_categories: 7
  ip_features: []
  exclude_fields: ["label", "difficulty"]

# Configurazione features per formato UNSW-NB15 (CSV)
unsw_nb15_features:
  timestamp_field: "Timestamp"  # se mancante viene creato
  continuous_features:
    - field: "srcip"
      normalize: true
      encoding: "hash_numeric"
      hash_size: 32
    - field: "sport"
      normalize: true
      encoding: "direct"
    - field: "dstip"
      normalize: true
      encoding: "hash_numeric"
      hash_size: 32
    - field: "dsport"
      normalize: true
      encoding: "direct"
    - field: "sbytes"
      normalize: true
      encoding: "log_scale"
    - field: "dbytes"
      normalize: true
      encoding: "log_scale"
  categorical_features:
    - field: "proto"
      encoding: "one_hot"
      max_categories: 10
    - field: "state"
      encoding: "one_hot"
      max_categories: 10
    - field: "service"
      encoding: "one_hot"
      max_categories: 15
  ip_features: []
  exclude_fields: ["label", "Label"]

# Configurazione features per formato CEF - SOLO ESSENZIALI PER SNN
cef_features:
  # Campo timestamp obbligatorio
  timestamp_field: "rt"
  timestamp_fallback: ["start", "end"]
  
  # Features numeriche continue - PORTE E PROTOCOLLO
  continuous_features:
    - field: "spt"
      normalize: true
      encoding: "direct"
      description: "Porta sorgente"
    - field: "dpt"
      normalize: true
      encoding: "direct"
      description: "Porta destinazione"
    - field: "proto"
      normalize: true
      encoding: "direct"
      description: "Protocollo"
    - field: "out"
      normalize: true
      encoding: "log_scale"
      description: "Bytes out (dimensione)"
    - field: "in"
      normalize: true
      encoding: "log_scale"
      description: "Bytes in (dimensione)"
  
  # Features categoriali - TIPO EVENTO E ESITO
  categorical_features:
    - field: "act"
      encoding: "one_hot"
      max_categories: 8
      description: "Azione/esito (blocked, allowed, etc)"
    - field: "severity"
      encoding: "ordinal"
      order: ["Low", "Medium", "High", "Critical"]
      description: "Severit√† evento"
  
  # Features IP - PATTERN DI TRAFFICO  
  ip_features:
    - field: "src"
      encoding: "crypto_pan"
      preserve_subnet: true
      subnet_bits: 24
      description: "IP sorgente"
    - field: "dst"
      encoding: "crypto_pan"
      preserve_subnet: true
      subnet_bits: 24
      description: "IP destinazione"
  
  # Features da escludere - TUTTO IL RESTO
  exclude_fields:
    - "cef_version"
    - "device_vendor"
    - "device_product"
    - "device_version"
    - "device_event_class_id"
    - "name"
    - "msg"
    - "cs1"
    - "cs2"
    - "cs3"
    - "cs4"
    - "cs5"
    - "cs6"
    - "cn1"
    - "cn2"
    - "cn3"
    - "flexString1"
    - "flexString2"
    - "dvc"
    - "dvchost"

# Configurazione features per formato Syslog - SOLO ESSENZIALI PER SNN
syslog_features:
  # Campo timestamp obbligatorio
  timestamp_field: "timestamp_str"
  
  # Features numeriche continue - PROTOCOLLO/FLAG
  continuous_features:
    - field: "facility"
      normalize: true
      encoding: "direct"
      description: "Facility (tipo servizio)"
    - field: "severity"
      normalize: true
      encoding: "direct"
      description: "Severit√† (0-7)"
  
  # Features categoriali - TIPO EVENTO
  categorical_features:
    - field: "tag"
      encoding: "hash_numeric"
      hash_size: 8
      description: "Tag applicazione"
    - field: "app_name"
      encoding: "hash_numeric"
      hash_size: 8
      description: "Nome applicazione"
  
  # Features IP - SE PRESENTI NEL MESSAGGIO
  ip_features: []  # Syslog base non ha campi IP standard
  
  # Features da escludere - TUTTO IL RESTO
  exclude_fields:
    - "hostname"  # Alta cardinalit√†
    - "version"
    - "procid"
    - "msgid"
    - "structured_data"
    - "message"  # Troppo variabile per SNN

# Configurazione output
output_format:
  # Formato file output
  file_format: "csv"  # "csv", "json", "parquet"
  
  # Separatore CSV
  csv_separator: ","
  
  # Include header
  include_header: true
  
  # Prefisso colonne
  feature_prefix: "feat_"
  
  # Suffisso per finestre temporali
  window_suffix: "_win_{window_ms}ms"

# Configurazione sicurezza
security:
  # Chiave per Crypto-PAn (deve essere 32 bytes hex)
  crypto_pan_key: "0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef"
  
  # Sale per hash sicuri
  hash_salt: "snn_secure_salt_2024"
  
  # Salva mapping per reverse lookup (ATTENZIONE: disabilitare in produzione)
  save_feature_mapping: true
  mapping_file: "snn_feature_mapping.json"
  
  # Salva statistiche normalizzazione
  save_normalization_stats: true
  normalization_stats_file: "snn_normalization_stats.json"

# Configurazione validazione
validation:
  # Controlla che tutti i valori siano in [0,1]
  check_normalized_range: true
  
  # Controlla sequenza temporale
  check_temporal_order: true
  
  # Soglia massima valori NaN
  max_nan_ratio: 0.1
  
  # Strategia per valori mancanti
  missing_value_strategy: "interpolate"  # "drop", "interpolate", "zero", "mean"
